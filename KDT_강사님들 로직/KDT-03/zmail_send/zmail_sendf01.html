<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>
<head>
<title>ZMAIL_SENDF01</title>
</head>
<body bgcolor="#FFFFE0">
<font size="3" face = "Arial" color="#000000"><b>Code listing for: ZMAIL_SENDF01</b></font>
<br>
<font size="3" face = "Arial" color="#000000"><b>Description:  Include ZMAIL_SENDF01</b></font>
<hr>
<pre width="100">
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Include          ZMAIL_SENDF01</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_init_value</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_init_value .

  pa_bukrs = '1000'.

  SELECT SINGLE butxt INTO pa_butxt
    FROM t001
    WHERE bukrs EQ pa_bukrs.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form modify_screen</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM modify_screen .

  LOOP AT SCREEN.

    CASE screen-group1.
      WHEN 'BUK'.
        screen-input = 0.
        MODIFY SCREEN.
      WHEN 'BUT'.
        screen-intensified = 1.
        MODIFY SCREEN.
    ENDCASE.

  ENDLOOP.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form get_base_data</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM get_base_data .

  CLEAR : gt_body, gs_body.
  SELECT * INTO CORRESPONDING FIELDS OF TABLE gt_body
    FROM ztbkpf
    WHERE bukrs EQ pa_bukrs
      AND budat IN so_budat.

  IF gt_body IS INITIAL.
    MESSAGE s037 DISPLAY LIKE 'E'.
    STOP.
  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form display_screen</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM display_screen .

  DATA : lv_cnt TYPE i.

  gs_variant = VALUE #( report  = sy-repid
                        handle  = 'ZZ' ).

  IF go_container IS NOT BOUND.

    CLEAR : gt_fcat, gs_fcat.
    PERFORM set_field_catalog USING : 'X' 'GJAHR' 'ZTBKPF' 'C' ' ',
                                      'X' 'BELNR' 'ZTBKPF' 'C' ' ',
                                      ' ' 'BLART' 'ZTBKPF' 'C' ' ',
                                      ' ' 'BUDAT' 'ZTBKPF' 'C' ' ',
                                      ' ' 'BKTXT' 'ZTBKPF' ' ' 'X',
                                      ' ' 'WAERS' 'ZTBKPF' 'C' ' ',
                                      ' ' 'DMBTR' 'ZTBKPF' ' ' ' '.

    gs_layout = VALUE #( zebra      = abap_true
                         cwidth_opt = abap_true
                         sel_mode   = 'D' ).

    PERFORM create_object.

    SET HANDLER : lcl_event_handler=&gt;top_of_page   FOR go_alv_grid.

    CALL METHOD go_alv_grid-&gt;set_table_for_first_display
      EXPORTING
        i_save          = 'A'
        i_default       = 'X'
        is_layout       = gs_layout
        is_variant      = gs_variant
      CHANGING
        it_outtab       = gt_body
        it_fieldcatalog = gt_fcat.

    PERFORM register_event.

    lv_cnt = lines( gt_body ).
    MESSAGE s001 WITH lv_cnt '건이 조회되었습니다.'.

  ELSE.
    PERFORM refresh_table.
  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_field_catalog</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_field_catalog  USING pv_key pv_field pv_table pv_just pv_emph.

  gs_fcat = VALUE #( key        = pv_key
                     fieldname  = pv_field
                     ref_table  = pv_table
                     just       = pv_just
                     emphasize  = pv_emph ).

  CASE pv_field.
    WHEN 'DMBTR'.
      gs_fcat-cfieldname  = 'WAERS'.
  ENDCASE.

  APPEND gs_fcat TO gt_fcat.
  CLEAR gs_fcat.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form create_object</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM create_object .

  CREATE OBJECT go_top_container
    EXPORTING
      repid     = sy-cprog
      dynnr     = sy-dynnr
      side      = go_top_container-&gt;dock_at_top
      extension = 80.

  CREATE OBJECT go_container
    EXPORTING
      repid     = sy-cprog
      dynnr     = sy-dynnr
      side      = go_container-&gt;dock_at_left
      extension = 3000.

  CREATE OBJECT go_alv_grid
    EXPORTING
      i_parent = go_container.

<font color ="#0000FF">* Create TOP-Document</font>
  CREATE OBJECT go_dyndoc_id
    EXPORTING
      style = 'ALV_GRID'.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form register_event</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM register_event .

  CALL METHOD go_dyndoc_id-&gt;initialize_document
    EXPORTING
      background_color = cl_dd_area=&gt;col_textarea.

  CALL METHOD go_alv_grid-&gt;list_processing_events
    EXPORTING
      i_event_name = 'TOP_OF_PAGE'
      i_dyndoc_id  = go_dyndoc_id.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form refresh_table</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM refresh_table .

  gs_stable = VALUE #( col = abap_true
                       row = abap_true ).

  CALL METHOD go_alv_grid-&gt;refresh_table_display
    EXPORTING
      is_stable = gs_stable.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form event_top_of_page</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM event_top_of_page .

  DATA : lr_dd_table TYPE REF TO cl_dd_table_element,
         col_field   TYPE REF TO cl_dd_area,
         col_value   TYPE REF TO cl_dd_area.

  DATA : lv_text TYPE sdydo_text_element,
         lv_icon TYPE icon-id.

  CALL METHOD go_dyndoc_id-&gt;add_table
    EXPORTING
      no_of_columns = 2
      border        = '0'
    IMPORTING
      table         = lr_dd_table.

<font color ="#0000FF">*-- Set column</font>
  CALL METHOD lr_dd_table-&gt;add_column
    IMPORTING
      column = col_field.

  CALL METHOD lr_dd_table-&gt;add_column
    IMPORTING
      column = col_value.

<font color ="#0000FF">*-- 회사코드</font>
  SELECT SINGLE butxt INTO lv_text
    FROM t001
    WHERE bukrs EQ pa_bukrs.

  PERFORM add_row USING lr_dd_table col_field col_value '회사코드' lv_text.

<font color ="#0000FF">*-- 회계연도</font>
  lv_text = '2023' && '년'.
  PERFORM add_row USING lr_dd_table col_field col_value '회계연도' lv_text.

  lv_text = 'Send mail'.
  PERFORM add_row USING lr_dd_table col_field col_value '작업구분' lv_text.

<font color ="#0000FF">*-- Icon</font>
  lv_text = 'GREEN'.
  PERFORM add_row USING lr_dd_table col_field col_value '결재대기' lv_text.

  lv_text = 'YELLOW'.
  PERFORM add_row USING lr_dd_table col_field col_value '결재보류' lv_text.

  lv_text = 'RED'.
  PERFORM add_row USING lr_dd_table col_field col_value '결재반려' lv_text.

  PERFORM set_top_of_page.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form add_row</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*&      --&gt; LR_DD_TABLE</font>
<font color ="#0000FF">*&      --&gt; COL_FIELD</font>
<font color ="#0000FF">*&      --&gt; COL_VALUE</font>
<font color ="#0000FF">*&      --&gt; P_</font>
<font color ="#0000FF">*&      --&gt; LV_TEXT</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM add_row  USING pr_dd_table  TYPE REF TO cl_dd_table_element
                    pv_col_field TYPE REF TO cl_dd_area
                    pv_col_value TYPE REF TO cl_dd_area
                    pv_field
                    pv_text.

  DATA : lv_text TYPE sdydo_text_element,
         lv_icon TYPE iconname.

<font color ="#0000FF">*-- Field.</font>
  lv_text = pv_field.

  CALL METHOD pv_col_field-&gt;add_text
    EXPORTING
      text         = lv_text
      sap_emphasis = cl_dd_document=&gt;strong
      sap_color    = cl_dd_document=&gt;list_heading_inv.

  CALL METHOD pv_col_field-&gt;add_gap
    EXPORTING
      width = 3.

<font color ="#0000FF">*-- Value.</font>
  CASE pv_text.
    WHEN 'GREEN'.
      CALL METHOD pv_col_value-&gt;add_icon
        EXPORTING
          sap_icon = 'ICON_LED_GREEN'.
    WHEN 'RED'.
      CALL METHOD pv_col_value-&gt;add_icon
        EXPORTING
          sap_icon = 'ICON_LED_RED'.
    WHEN 'YELLOW'.
      CALL METHOD pv_col_value-&gt;add_icon
        EXPORTING
          sap_icon = 'ICON_LED_YELLOW'.
    WHEN OTHERS.
      lv_text = pv_text.
      CALL METHOD pv_col_value-&gt;add_text
        EXPORTING
          text         = lv_text
          sap_emphasis = cl_dd_document=&gt;heading
          sap_color    = cl_dd_document=&gt;list_negative_inv.
  ENDCASE.

  CALL METHOD pv_col_value-&gt;add_gap
    EXPORTING
      width = 3.

  CALL METHOD pr_dd_table-&gt;new_row.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form set_top_of_page</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM set_top_of_page .

<font color ="#0000FF">* Creating html control</font>
  IF go_html_cntrl IS INITIAL.
    CREATE OBJECT go_html_cntrl
      EXPORTING
        parent = go_top_container.
  ENDIF.

  CALL METHOD go_dyndoc_id-&gt;merge_document.
  go_dyndoc_id-&gt;html_control = go_html_cntrl.

<font color ="#0000FF">* Display document</font>
  CALL METHOD go_dyndoc_id-&gt;display_document
    EXPORTING
      reuse_control      = 'X'
      parent             = go_top_container
    EXCEPTIONS
      html_display_error = 1.

  IF sy-subrc NE 0.
    MESSAGE s001 WITH TEXT-e01 DISPLAY LIKE 'E'.
  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form mail_process</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM mail_process .

  DATA : lt_roid TYPE lvc_t_roid,
         ls_roid TYPE lvc_s_roid,
         lv_msg  TYPE string,
         lv_cnt  TYPE i.

  CALL METHOD go_alv_grid-&gt;get_selected_rows
    IMPORTING
      et_row_no = lt_roid.

  IF lt_roid IS INITIAL.
    MESSAGE s001 WITH TEXT-e02 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

  lv_cnt = lines( lt_roid ).

  IF lv_cnt GT 1.
    MESSAGE s001 WITH TEXT-e03 DISPLAY LIKE 'E'.
    EXIT.
  ENDIF.

  ls_roid = VALUE #( lt_roid[ 1 ] OPTIONAL ).

  CLEAR gs_body.
  gs_body = VALUE #( gt_body[ ls_roid-row_id ] OPTIONAL ).

<font color ="#0000FF">**********************************************************************</font>
<font color ="#0000FF">* Mail process</font>
<font color ="#0000FF">**********************************************************************</font>
  PERFORM make_email_content.

<font color ="#0000FF">*-- Call send mail function</font>
  _init reclist.
  reclist-receiver = 'icfreeman@nate.com'.
  reclist-rec_type = 'U'.
  APPEND reclist.

  CALL FUNCTION 'SO_NEW_DOCUMENT_ATT_SEND_API1'
    EXPORTING
      document_data              = doc_chng
      put_in_outbox              = 'X'
      commit_work                = 'X'
    TABLES
      packing_list               = objpack
      contents_bin               = objbin
      contents_txt               = objtxt
      receivers                  = reclist
    EXCEPTIONS
      too_many_receivers         = 1
      document_not_sent          = 2
      document_type_not_exist    = 3
      operation_no_authorization = 4
      parameter_error            = 5
      x_error                    = 6
      enqueue_error              = 7
      OTHERS                     = 8.

  IF sy-subrc NE 0.
    _msg_build sy-msgid sy-msgno sy-msgv1 sy-msgv2
               sy-msgv3 sy-msgv4 lv_msg.
    MESSAGE s001 WITH lv_msg DISPLAY LIKE 'E'.
  ELSE.
    MESSAGE s001 WITH TEXT-s01.
  ENDIF.

ENDFORM.
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& Form make_email_content</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
<font color ="#0000FF">*& --&gt;  p1        text</font>
<font color ="#0000FF">*& &lt;--  p2        text</font>
<font color ="#0000FF">*&---------------------------------------------------------------------*</font>
FORM make_email_content .
<font color ="#0000FF">**********************************************************************</font>
<font color ="#0000FF">* Create mail content - HTML Format</font>
<font color ="#0000FF">**********************************************************************</font>
  DATA : lv_email      TYPE pa0105-usrid,
         lv_str        TYPE string,
         lv_objbin     LIKE TABLE OF objbin WITH HEADER LINE,
         lv_amount(20),
         lv_date(10),
         lv_title(200).

<font color ="#0000FF">*-- Begin of attachment</font>
  DATA act_filetype     LIKE  rlgrap-filetype.
  DATA act_filename     LIKE  rlgrap-filename.
<font color ="#0000FF">*-- End of attachment</font>

  CLASS cl_abap_char_utilities DEFINITION LOAD.
  CONSTANTS : lv_vt   TYPE c VALUE cl_abap_char_utilities=&gt;horizontal_tab,
              lv_cret TYPE c VALUE cl_abap_char_utilities=&gt;cr_lf.

<font color ="#0000FF">**********************************************************************</font>
<font color ="#0000FF">* 첨부파일</font>
<font color ="#0000FF">**********************************************************************</font>
  DATA : file      LIKE rlgrap-filename,
         mail_file TYPE string.

  IF pa_attch IS NOT INITIAL.

    CALL FUNCTION 'UPLOAD'
      EXPORTING
        filetype     = 'BIN'
      IMPORTING
        act_filename = act_filename
        act_filetype = act_filetype
      TABLES
        data_tab     = objbin.

  ENDIF.

  _init : objtxt, objpack.
<font color ="#0000FF">**********************************************************************</font>
<font color ="#0000FF">* Set mail title</font>
<font color ="#0000FF">**********************************************************************</font>
  CLEAR : lv_date, lv_title.
  lv_date  = gs_body-budat(4) && '년' && gs_body-budat+4(2) && '월'.
  CONCATENATE lv_date ' ' '전표내역' INTO lv_title RESPECTING BLANKS.

  CLEAR : doc_chng, lv_str.
  CONCATENATE
    '&lt;META http-equiv=Content-Type content="text/html; charset=euc-kr"&gt;' ''
    INTO lv_str SEPARATED BY lv_vt.
  CONCATENATE lv_cret lv_str lv_vt INTO lv_str.
  objtxt = lv_str.
  APPEND objtxt.

  CLEAR lv_str.
  CONCATENATE
    '&lt;tbody&gt;' ''
    INTO lv_str SEPARATED BY lv_vt.
  CONCATENATE lv_cret lv_str lv_vt INTO lv_str.
  objtxt = lv_str.
  APPEND objtxt.

  CLEAR lv_str.
  CONCATENATE
    '&lt;center&gt;' ''
    INTO lv_str SEPARATED BY lv_vt.
  CONCATENATE lv_cret lv_str lv_vt INTO lv_str.
  objtxt = lv_str.
  APPEND objtxt.

  CLEAR lv_str.
  CONCATENATE
    '&lt;hr&gt;&lt;h1&gt;' lv_date '전표내역.&lt;/h1&gt;&lt;hr&gt;&lt;br&gt;&lt;br&gt;'
    INTO lv_str SEPARATED BY lv_vt.
  CONCATENATE lv_cret lv_str lv_vt INTO lv_str.
  objtxt = lv_str.
  APPEND objtxt.

<font color ="#0000FF">**********************************************************************</font>
<font color ="#0000FF">* Mail contents</font>
<font color ="#0000FF">**********************************************************************</font>
  CLEAR lv_str.
  CONCATENATE
    '&lt;table cellpadding="0" cellspacing="0" bgcolor="royalblue"&gt;'
      '&lt;tr&gt;'
        '&lt;td&gt;'
          '&lt;table cellpadding="0" cellspacing="1" width="800"&gt;'
    INTO lv_str SEPARATED BY lv_vt.
  CONCATENATE lv_cret lv_str lv_vt INTO lv_str.
  objtxt = lv_str.
  APPEND objtxt.

<font color ="#0000FF">*-- 전표번호</font>
  CLEAR lv_str.
  CONCATENATE
    '&lt;tr&gt;'
    '&lt;td bgcolor="lightgray" valign="center" align="left" height="30" width="100"&gt;'
    '&lt;font size="2"&gt; &lt;b&gt;전표번호&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;'
    '&lt;td bgcolor="white" valign="center" align="left" height="30"&gt;&lt;font size="2"&gt;'
    ' ' gs_body-belnr '&lt;/font&gt;'
    '&lt;/td&gt;'
    '&lt;/tr&gt;'
    INTO lv_str SEPARATED BY lv_vt.
  CONCATENATE lv_cret lv_str lv_vt INTO lv_str.
  objtxt = lv_str.
  APPEND objtxt.

<font color ="#0000FF">*-- 전기일자</font>
  CLEAR lv_str.
  CONCATENATE
    '&lt;tr&gt;'
    '&lt;td bgcolor="lightgray" valign="center" align="left" height="30"&gt;'
    '&lt;font size="2"&gt; &lt;b&gt;전기일자&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;'
    '&lt;td bgcolor="white" valign="center" align="left" height="30"&gt;&lt;font size="2"&gt;'
    ' ' gs_body-budat '&lt;/font&gt;'
    '&lt;/td&gt;'
    '&lt;/tr&gt;'
    INTO lv_str SEPARATED BY lv_vt.
  CONCATENATE lv_cret lv_str lv_vt INTO lv_str.
  objtxt = lv_str.
  APPEND objtxt.

<font color ="#0000FF">*-- 전표유형</font>
  CLEAR lv_str.
  CONCATENATE
    '&lt;tr&gt;'
    '&lt;td bgcolor="lightgray" valign="center" align="left" height="30"&gt;'
    '&lt;font size="2"&gt; &lt;b&gt;전표유형&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;'
    '&lt;td bgcolor="white" valign="center" align="left" height="30"&gt;&lt;font size="2"&gt;'
    ' ' gs_body-blart '&lt;/font&gt;'
    '&lt;/td&gt;'
    '&lt;/tr&gt;'
    INTO lv_str SEPARATED BY lv_vt.
  CONCATENATE lv_cret lv_str lv_vt INTO lv_str.
  objtxt = lv_str.
  APPEND objtxt.

<font color ="#0000FF">*-- 전표헤더 텍스트</font>
  CLEAR lv_str.
  CONCATENATE
    '&lt;tr&gt;'
    '&lt;td bgcolor="lightgray" valign="center" align="left" height="30"&gt;'
    '&lt;font size="2"&gt; &lt;b&gt;전표헤더 텍스트&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;'
    '&lt;td bgcolor="white" valign="center" align="left" height="30"&gt;&lt;font size="2"&gt;'
    ' ' gs_body-bktxt '&lt;/font&gt;'
    '&lt;/td&gt;'
    '&lt;/tr&gt;'
    INTO lv_str SEPARATED BY lv_vt.
  CONCATENATE lv_cret lv_str lv_vt INTO lv_str.
  objtxt = lv_str.
  APPEND objtxt.

<font color ="#0000FF">*-- 통화키</font>
  CLEAR lv_str.
  CONCATENATE
    '&lt;tr&gt;'
    '&lt;td bgcolor="lightgray" valign="center" align="left" height="30"&gt;'
    '&lt;font size="2"&gt; &lt;b&gt;통화키&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;'
    '&lt;td bgcolor="white" valign="center" align="left" height="30"&gt;&lt;font size="2"&gt;'
    ' ' gs_body-waers '&lt;/font&gt;'
    '&lt;/td&gt;'
    '&lt;/tr&gt;'
    INTO lv_str SEPARATED BY lv_vt.
  CONCATENATE lv_cret lv_str lv_vt INTO lv_str.
  objtxt = lv_str.
  APPEND objtxt.

<font color ="#0000FF">*-- 전표통화금액</font>
  CLEAR lv_amount.
  WRITE gs_body-dmbtr CURRENCY gs_body-waers TO lv_amount.

  CLEAR lv_str.
  CONCATENATE
    '&lt;tr&gt;'
    '&lt;td bgcolor="lightgray" valign="center" align="left" height="30"&gt;'
    '&lt;font size="2"&gt; &lt;b&gt;전표통화금액&lt;/b&gt;&lt;/font&gt;&lt;/td&gt;'
    '&lt;td bgcolor="white" valign="center" align="left" height="30"&gt;&lt;font size="2"&gt;'
    ' ' lv_amount '&lt;/font&gt;'
    '&lt;/td&gt;'
    '&lt;/tr&gt;'
    INTO lv_str SEPARATED BY lv_vt.
  CONCATENATE lv_cret lv_str lv_vt INTO lv_str.
  objtxt = lv_str.
  APPEND objtxt.

<font color ="#0000FF">*-- HTML Table 마무리</font>
  CLEAR lv_str.
  CONCATENATE
    '&lt;/table&gt;'
      '&lt;/td&gt;&lt;/tr&gt;'
      '&lt;/table&gt;' '&lt;br&gt;'
      '&lt;/center&gt;'
      '&lt;/tbody&gt;'
   INTO lv_str SEPARATED BY lv_vt.
  CONCATENATE lv_cret lv_str lv_vt INTO lv_str.
  objtxt = lv_str.
  APPEND objtxt.

<font color ="#0000FF">*-- Content option</font>
  CLEAR : tab_lines, lv_str.
  DESCRIBE TABLE objtxt LINES tab_lines.
  READ TABLE objtxt INDEX tab_lines.
  doc_chng-doc_size = ( tab_lines - 1 ) * 12255 + strlen( objtxt ).

<font color ="#0000FF">*-- 메일 헤더, 본문 정보</font>
  CLEAR objpack-transf_bin.
  objpack-head_start = 1.
  objpack-head_num = 0.
  objpack-body_start = 1.
  objpack-body_num = tab_lines.
  objpack-doc_type = 'HTM'.
  APPEND objpack.

  DATA: objhead LIKE solisti1 OCCURS 1 WITH HEADER LINE.
  objhead = act_filename.
  APPEND objhead.

  DATA f_lines TYPE i.
  DATA doc_size TYPE i.

  DATA : BEGIN OF lt_split OCCURS 0,
          content(50),
         END OF lt_split.

  CLEAR : tab_lines.
  DESCRIBE TABLE objbin LINES f_lines.
  doc_chng-doc_size = f_lines * 255.
  doc_chng-obj_name = 'Request mail'.
  doc_chng-obj_descr = lv_title.

  DATA: doc_type(3).

  IF pa_attch IS NOT INITIAL.

<font color ="#0000FF">*-- Get file name</font>
    SPLIT act_filename AT '\' INTO TABLE lt_split.
    READ TABLE lt_split INDEX lines( lt_split ).

<font color ="#0000FF">*-- Get document type</font>
    SPLIT act_filename AT '.' INTO act_filename doc_type.

<font color ="#0000FF">*-- Attachment (pdf-Attachment)</font>
    objpack-transf_bin = 'X'. " 이진형식의 전송을 위한 플래그
    objpack-head_start = 1.   " 본문의 시작
    objpack-head_num   = 0.   " 본문 헤더라인 수
    objpack-body_start = 1.   " 첨부파일 본문의 시작
    objpack-doc_size = doc_chng-doc_size.
    objpack-body_num = f_lines.         " 첨부 파일 본문의 길이
    objpack-doc_type = doc_type.        " 문서타입
    objpack-obj_name = doc_type && '_file'.  " 객체이름
    objpack-obj_descr = lt_split-content.    " 파일이름
    APPEND objpack.

  ENDIF.

ENDFORM.
</pre>
<hr>
<font size="2" face = "Sans Serif">Extracted by Direct Download Enterprise version 1.3.1 - E.G.Mellodew. 1998-2005 UK. Sap Release 754
</font>
</body>
</html>
